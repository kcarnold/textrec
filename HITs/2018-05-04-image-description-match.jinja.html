<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<style>

.outer-container {
/*  display: flex;
  flex-flow: row nowrap;
  width: 100%;
*/}

#submitButton{
  white-space: normal;
}

.instructions {
  flex: 0 0 150px;
}

.image-option button:disabled {
  cursor: not-allowed;
  opacity: .25;
}
</style>

<meta content="width=device-width,initial-scale=1" name="viewport" />
<section class="outer-container">

  <section class="instructions">
    <p>Someone wrote this description for one of the {{images|length}} images below:</p>

    <blockquote><b style="font-size: 200%">&ldquo;{{description}}&rdquo;</b></blockquote>

    <p>Try to guess which of the {{images|length}} images this description was written for. Click an image to guess it. Try to get it in as few guesses as possible.</p>

    <p>If any of the images doesn't load, make a note in the feedback section and submit the HIT incomplete.</p>
  </section>


<div style="flex: 1 0 0; overflow: auto; display: flex; flex-flow: row wrap; align-items: center;">
{% for url in images %}
<div style="flex: 0 0 300px; padding: 10px;" class="image-option" data-idx="{{loop.index0}}">
  <button class="guess">
    <img src="{{url}}" style="max-width: 100%; max-height: 400px; display: inline-block;" alt="Image {{loop.index}} should appear here">
  </button>
</div>
{% endfor %}
</div>
</section>

<p>
  This is a new HIT, so we&#39;d appreciate your feedback: are the instructions clear? Is the payment fair? Any technical difficulties? Anything else?<br>
  <textarea cols="80" name="feedback" placeholder="optional feedback" rows="4"></textarea>
</p>


<input id="data-description" type="hidden" name="description" value="{{description}}">
<input id="data-images" type="hidden" name="images" value="{{images|join('|')}}">
<input id="data-correct-idx" type="hidden" name="correctIdx" values="{{correct_idx}}">
<input id="data-guesses" type="hidden" name="guesses" value="[]">

<script
        src="https://code.jquery.com/jquery-3.3.1.slim.js"
        integrity="sha256-fNXJFIlca05BIO2Y5zh1xrShK3ME+/lYZ0j+ChxX2DA="
        crossorigin="anonymous"></script>
<script>
var correctIdx = ${correct_idx};
var guesses = [];
$(function() {
  $('.image-option').on('click', 'button.guess', function(event) {
    var idx = +$(event.delegateTarget).attr('data-idx');
    console.log('click', idx);
    $(event.target).prop('disabled', true);
    guesses.push({
      idx: idx,
      timestamp: +new Date()
    });
    $('#data-guesses').val(JSON.stringify(guesses));

    if (idx === correctIdx) {
      alert("Got it! You can submit the HIT now.");
    } else {
      alert("Oops, try again!");
    }
  });
});
</script>